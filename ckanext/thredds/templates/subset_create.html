{% resource 'ckanext-spatial/spatial_form' %}
{% resource 'thredds/subset_map.js' %}
{% resource 'thredds/jquery.datetimepicker.full.js' %}
{% resource 'thredds/subset_datepicker.js' %}

{% import 'macros/form.html' as form %}

{% extends "page.html" %}

{% block subtitle %}{{ _('Create Subset') }}{% endblock %}

{% block primary %}
    {% block form %}
      <div class="module-content">
          <h1>{{ title }}</h1>
          <form action="{% url_for controller='ckanext.thredds.controllers.subset:SubsetController', action='submit_subset' %}" method="post" enctype="multipart/form-data">
              <h3>Layers</h3>
              {% for layer in layers %}
                <input type="checkbox" name="layers" value="{{ layer['id'] }}"> {{ layer['label'] }} <br><br>
              {% endfor %}
              {% set default_extent = '[[' + bbox[3] + ', ' + bbox[2] + '], [' + bbox[1] + ', ' + bbox[0] + ']]' %}

              <h3>Coordinates</h3>

              {% set map_config = h.get_common_map_config() %}
                <div class="dataset-map"
                    data-module="subset-map"
                    data-input_id="coordinates"
                    data-module-site_url="{{ h.dump_json(h.url('/', locale='default', qualified=true)) }}"
                    data-module-map_config="{{ h.dump_json(map_config) }}"
                    data-module-default_extent="{{ default_extent }}">
                  <div id="dataset-map-container"></div>
                </div>
                {{ form.info(text="Draw the subset extent on the map", inline=false) }}

                <textarea id="coordinates" name="coordinates" rows=5 style="width:100%;"></textarea>

             <h3>Date</h3>
            <label>From</label>
            <input id="time_start" name="time_start" data-module="subset_datepicker" type="text"><br><br>
             <label>To</label>
             <input id="time_end" name="time_end" data-module="subset_datepicker" type="text"><br><br>

             <h3>Format</h3>
              <input type="radio" name="accept" id="radio_netcdf" value="netCDF4" checked> netCDF4 &emsp;
              <input type="radio" name="accept" id="radio_csv" value="CSV"> CSV &emsp;
              <input type="radio" name="accept" id="radio_xml" value="XML"> XML
            <br><br>

            {% if is_anon == False %}
                <h3>Would you like to create a new resource?</h3>
                <input type="radio" name="res_create" value="True" checked> Yes &emsp; <b>Package Title:</b> <input type="text" name="title"> <br>
                <input type="radio" name="res_create" value="False"> No
                <br><br>
            {% endif %}

              <input type="submit" value="Create Subset">
          </form>
      </div>

      <link rel="stylesheet" href="/css/subset.css"/>
      <link rel="stylesheet" type="text/css" href="/css/subset_jquery.datetimepicker.css"/>
    {% endblock %}
{% endblock %}
